<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, viewport-fit=cover">
    <meta name="color-scheme" content="light dark">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: https://ssl.gstatic.com https://temple-giving-dharanipriya154.replit.dev 'unsafe-eval' 'unsafe-inline'; object-src 'none'; style-src 'self' 'unsafe-inline'; img-src 'self' data: content:;">
    
    <title>Temple Donations</title>
    <link rel="stylesheet" href="css/mobile-styles.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #8B5A3C 0%, #A0522D 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .app-header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            color: white;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }
        
        .app-header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .app-header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .content-container {
            flex: 1;
            background: white;
            margin: 20px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            padding: 40px 20px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #8B5A3C;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #666;
            font-size: 16px;
            text-align: center;
        }
        
        .error-container {
            padding: 40px 20px;
            text-align: center;
            color: #e74c3c;
        }
        
        .error-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .error-message {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 20px;
        }
        
        .retry-button {
            background: #8B5A3C;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .retry-button:hover {
            background: #A0522D;
        }
        
        .webapp-frame {
            width: 100%;
            height: 100%;
            border: none;
            min-height: calc(100vh - 120px);
        }
        
        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #27ae60;
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.3);
            z-index: 1000;
        }
        
        .connection-status.offline {
            background: #e74c3c;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.3);
        }
        
        .language-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            backdrop-filter: blur(5px);
        }
    </style>
</head>

<body>
    <div class="connection-status" id="connectionStatus"></div>
    
    <div class="app-header">
        <div class="temple-symbol">üïâÔ∏è</div>
        <button class="language-toggle" id="languageToggle">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</button>
        <h1 id="appTitle">Temple Donations</h1>
        <p id="appSubtitle">Mobile Donation Management</p>
    </div>
    
    <div class="content-container">
        <div class="loading-container" id="loadingContainer">
            <div class="spinner"></div>
            <div class="loading-text" id="loadingText">Connecting to Temple System...</div>
            <div class="loading-subtitle" id="loadingSubtitle">Please wait while we establish connection</div>
        </div>
        
        <div class="error-container" id="errorContainer" style="display: none;">
            <div class="error-icon">‚ö†Ô∏è</div>
            <div class="error-title" id="errorTitle">Connection Failed</div>
            <div class="error-message" id="errorMessage">Unable to connect to the temple donation system. Please check your internet connection.</div>
            <button class="retry-button" onclick="loadWebApp()">Try Again</button>
        </div>
        
        <iframe id="webappFrame" class="webapp-frame" style="display: none;"></iframe>
    </div>
    
    <div class="status-bar" id="statusBar">
        <div class="status-text" id="statusText">Ready</div>
        <div class="status-time" id="statusTime"></div>
    </div>

    <script src="cordova.js"></script>
    <script>
        // Configuration
        const WEB_APP_URL = 'https://temple-giving-dharanipriya154.replit.dev';
        let currentLanguage = 'en';
        
        // Translation strings
        const translations = {
            en: {
                appTitle: 'Temple Donations',
                appSubtitle: 'Mobile Donation Management',
                loadingText: 'Connecting to Temple System...',
                loadingSubtitle: 'Please wait while we establish connection',
                errorTitle: 'Connection Failed',
                errorMessage: 'Unable to connect to the temple donation system. Please check your internet connection.',
                retryButton: 'Try Again',
                languageButton: '‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç',
                statusConnected: 'Connected to Temple System',
                statusDisconnected: 'No Internet Connection'
            },
            ta: {
                appTitle: '‡Æï‡Øã‡ÆØ‡Æø‡Æ≤‡Øç ‡Æ®‡Æ©‡Øç‡Æï‡Øä‡Æü‡Øà',
                appSubtitle: '‡ÆÆ‡Øä‡Æ™‡Øà‡Æ≤‡Øç ‡Æ®‡Æ©‡Øç‡Æï‡Øä‡Æü‡Øà ‡ÆÆ‡Øá‡Æ≤‡Ææ‡Æ£‡Øç‡ÆÆ‡Øà',
                loadingText: '‡Æï‡Øã‡ÆØ‡Æø‡Æ≤‡Øç ‡ÆÖ‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡ØÅ‡Æü‡Æ©‡Øç ‡Æá‡Æ£‡Øà‡Æï‡Øç‡Æï‡Æø‡Æ±‡Æ§‡ØÅ...',
                loadingSubtitle: '‡Æá‡Æ£‡Øà‡Æ™‡Øç‡Æ™‡Øà ‡Æ®‡Æø‡Æ±‡ØÅ‡Æµ‡ØÅ‡ÆÆ‡Øç ‡Æµ‡Æ∞‡Øà ‡Æï‡Ææ‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç',
                errorTitle: '‡Æá‡Æ£‡Øà‡Æ™‡Øç‡Æ™‡ØÅ ‡Æ§‡Øã‡Æ≤‡Øç‡Æµ‡Æø',
                errorMessage: '‡Æï‡Øã‡ÆØ‡Æø‡Æ≤‡Øç ‡Æ®‡Æ©‡Øç‡Æï‡Øä‡Æü‡Øà ‡ÆÖ‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡ØÅ‡Æü‡Æ©‡Øç ‡Æá‡Æ£‡Øà‡Æï‡Øç‡Æï ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà. ‡Æ§‡ÆØ‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æá‡Æ£‡Øà‡ÆØ ‡Æá‡Æ£‡Øà‡Æ™‡Øç‡Æ™‡Øà‡Æö‡Øç ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.',
                retryButton: '‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡ÆØ‡Æ±‡Øç‡Æö‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç',
                languageButton: 'English',
                statusConnected: '‡Æï‡Øã‡ÆØ‡Æø‡Æ≤‡Øç ‡ÆÖ‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡ØÅ‡Æü‡Æ©‡Øç ‡Æá‡Æ£‡Øà‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ',
                statusDisconnected: '‡Æá‡Æ£‡Øà‡ÆØ ‡Æá‡Æ£‡Øà‡Æ™‡Øç‡Æ™‡ØÅ ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà'
            }
        };
        
        // Device ready event
        document.addEventListener('deviceready', onDeviceReady, false);
        
        function onDeviceReady() {
            console.log('Cordova is ready');
            updateConnectionStatus(true);
            loadWebApp();
        }
        
        // Load web application
        function loadWebApp() {
            const iframe = document.getElementById('webappFrame');
            const loadingContainer = document.getElementById('loadingContainer');
            const errorContainer = document.getElementById('errorContainer');
            
            // Show loading
            loadingContainer.style.display = 'flex';
            errorContainer.style.display = 'none';
            iframe.style.display = 'none';
            
            // Set iframe source
            iframe.src = WEB_APP_URL;
            
            // Handle iframe load
            iframe.onload = function() {
                setTimeout(() => {
                    loadingContainer.style.display = 'none';
                    iframe.style.display = 'block';
                    updateConnectionStatus(true);
                }, 500);
            };
            
            // Handle iframe error
            iframe.onerror = function() {
                loadingContainer.style.display = 'none';
                errorContainer.style.display = 'block';
                updateConnectionStatus(false);
            };
            
            // Timeout fallback
            setTimeout(() => {
                if (iframe.style.display === 'none' && loadingContainer.style.display === 'flex') {
                    loadingContainer.style.display = 'none';
                    errorContainer.style.display = 'block';
                    updateConnectionStatus(false);
                }
            }, 10000);
        }
        
        // Update connection status indicator
        function updateConnectionStatus(connected) {
            const statusIndicator = document.getElementById('connectionStatus');
            if (connected) {
                statusIndicator.classList.remove('offline');
            } else {
                statusIndicator.classList.add('offline');
            }
        }
        
        // Language toggle functionality
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'en' ? 'ta' : 'en';
            updateLanguage();
        }
        
        function updateLanguage() {
            const t = translations[currentLanguage];
            
            document.getElementById('appTitle').textContent = t.appTitle;
            document.getElementById('appSubtitle').textContent = t.appSubtitle;
            document.getElementById('loadingText').textContent = t.loadingText;
            document.getElementById('loadingSubtitle').textContent = t.loadingSubtitle;
            document.getElementById('errorTitle').textContent = t.errorTitle;
            document.getElementById('errorMessage').textContent = t.errorMessage;
            document.getElementById('languageToggle').textContent = t.languageButton;
            
            const retryButton = document.querySelector('.retry-button');
            if (retryButton) {
                retryButton.textContent = t.retryButton;
            }
        }
        
        // Event listeners
        document.getElementById('languageToggle').addEventListener('click', toggleLanguage);
        
        // Network status monitoring
        document.addEventListener('online', function() {
            updateConnectionStatus(true);
            if (document.getElementById('errorContainer').style.display === 'block') {
                loadWebApp();
            }
        });
        
        document.addEventListener('offline', function() {
            updateConnectionStatus(false);
        });
        
        // Handle back button
        document.addEventListener('backbutton', function(e) {
            const iframe = document.getElementById('webappFrame');
            if (iframe.style.display === 'block') {
                // Let the web app handle back navigation
                e.preventDefault();
                return false;
            }
        });
        
        // Status bar functionality
        function updateStatusBar(message, showTime = true) {
            const statusText = document.getElementById('statusText');
            const statusTime = document.getElementById('statusTime');
            const statusBar = document.getElementById('statusBar');
            
            statusText.textContent = message;
            
            if (showTime) {
                const now = new Date();
                statusTime.textContent = now.toLocaleTimeString();
            } else {
                statusTime.textContent = '';
            }
            
            statusBar.classList.add('show');
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                statusBar.classList.remove('show');
            }, 3000);
        }
        
        // Enhanced device features
        function enableDeviceFeatures() {
            // Prevent screen sleep during app use
            if (window.plugins && window.plugins.insomnia) {
                window.plugins.insomnia.keepAwake();
            }
            
            // Handle device back button
            document.addEventListener('backbutton', handleBackButton, false);
            
            // Handle menu button
            document.addEventListener('menubutton', showAppMenu, false);
            
            // Battery status monitoring
            if (navigator.battery) {
                navigator.battery.addEventListener('levelchange', updateBatteryStatus);
            }
            
            // Update status bar on app resume
            document.addEventListener('resume', function() {
                const t = translations[currentLanguage];
                updateStatusBar(t.statusConnected);
                loadWebApp();
            });
            
            // Update status on app pause
            document.addEventListener('pause', function() {
                console.log('App paused');
            });
        }
        
        function handleBackButton(e) {
            e.preventDefault();
            const iframe = document.getElementById('webappFrame');
            
            if (iframe.style.display === 'block') {
                // Try to go back in the web app
                iframe.contentWindow.history.back();
            } else {
                // Exit app
                navigator.app.exitApp();
            }
        }
        
        function showAppMenu() {
            // Simple menu functionality
            const options = [
                currentLanguage === 'en' ? 'Refresh App' : '‡ÆÜ‡Æ™‡Øç‡Æ™‡Øà ‡Æ™‡ØÅ‡Æ§‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç',
                currentLanguage === 'en' ? 'Switch Language' : '‡ÆÆ‡Øä‡Æ¥‡Æø‡ÆØ‡Øà ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç',
                currentLanguage === 'en' ? 'About' : '‡Æ™‡Æ±‡Øç‡Æ±‡Æø'
            ];
            
            if (navigator.notification) {
                navigator.notification.actionSheet(
                    currentLanguage === 'en' ? 'App Menu' : '‡ÆÜ‡Æ™‡Øç ‡ÆÆ‡ØÜ‡Æ©‡ØÅ',
                    function(buttonIndex) {
                        switch(buttonIndex) {
                            case 1: loadWebApp(); break;
                            case 2: toggleLanguage(); break;
                            case 3: showAbout(); break;
                        }
                    },
                    currentLanguage === 'en' ? 'Temple Donations' : '‡Æï‡Øã‡ÆØ‡Æø‡Æ≤‡Øç ‡Æ®‡Æ©‡Øç‡Æï‡Øä‡Æü‡Øà',
                    options
                );
            }
        }
        
        function showAbout() {
            const message = currentLanguage === 'en' 
                ? 'Temple Donations v1.0\\nDeveloped for temple management\\nConnects to: ' + WEB_APP_URL
                : '‡Æï‡Øã‡ÆØ‡Æø‡Æ≤‡Øç ‡Æ®‡Æ©‡Øç‡Æï‡Øä‡Æü‡Øà v1.0\\n‡Æï‡Øã‡ÆØ‡Æø‡Æ≤‡Øç ‡Æ®‡Æø‡Æ∞‡Øç‡Æµ‡Ææ‡Æï‡Æ§‡Øç‡Æ§‡Æø‡Æ±‡Øç‡Æï‡Ææ‡Æï ‡Æâ‡Æ∞‡ØÅ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ\\n‡Æá‡Æ£‡Øà‡Æ™‡Øç‡Æ™‡ØÅ: ' + WEB_APP_URL;
                
            if (navigator.notification) {
                navigator.notification.alert(
                    message,
                    null,
                    currentLanguage === 'en' ? 'About' : '‡Æ™‡Æ±‡Øç‡Æ±‡Æø',
                    'OK'
                );
            } else {
                alert(message);
            }
        }
        
        function updateBatteryStatus() {
            if (navigator.battery && navigator.battery.level < 0.2) {
                const message = currentLanguage === 'en' 
                    ? 'Low battery - Consider charging your device'
                    : '‡Æï‡ØÅ‡Æ±‡Øà‡Æ®‡Øç‡Æ§ ‡Æ™‡Øá‡Æü‡Øç‡Æü‡Æ∞‡Æø - ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æö‡Ææ‡Æ§‡Æ©‡Æ§‡Øç‡Æ§‡Øà ‡Æö‡Ææ‡Æ∞‡Øç‡Æú‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç';
                updateStatusBar(message);
            }
        }
        
        // Enhanced network monitoring
        function setupNetworkMonitoring() {
            // Check connection quality
            function checkConnectionQuality() {
                const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                if (connection) {
                    const type = connection.effectiveType;
                    if (type === 'slow-2g' || type === '2g') {
                        const message = currentLanguage === 'en' 
                            ? 'Slow connection detected'
                            : '‡ÆÆ‡ØÜ‡Æ§‡ØÅ‡Æµ‡Ææ‡Æ© ‡Æá‡Æ£‡Øà‡Æ™‡Øç‡Æ™‡ØÅ ‡Æï‡Æ£‡Øç‡Æü‡Æ±‡Æø‡ÆØ‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ';
                        updateStatusBar(message);
                    }
                }
            }
            
            if (navigator.connection) {
                navigator.connection.addEventListener('change', checkConnectionQuality);
            }
        }
        
        // Initialize for web testing (if cordova not available)
        if (typeof cordova === 'undefined') {
            setTimeout(onDeviceReady, 500);
        } else {
            // Enable device features when Cordova is ready
            document.addEventListener('deviceready', function() {
                onDeviceReady();
                enableDeviceFeatures();
                setupNetworkMonitoring();
            });
        }
    </script>
</body>
</html>